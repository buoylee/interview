[TOC]



## 概述

redis默认有0~15, 16个db.



## 类型

Redis 的10种数据类型，分别是

- string（字符串）
- hash（哈希）
- list（列表）
- set（集合）
- zset（有序集合）
- stream（流）
- geospatial（地理）
- bitmap（位图）
- bitfield（位域）
- hyperloglog（基数统计）

## 类型与底层数据结构关系

![img](数据结构.assets/9fa26a74965efbf0f56b707a03bb9b7f-20230309232518487.png)

### 底层数据结构的对象关系

![RedisDB主体数据结构](RedisDB主体数据结构.png)

## string

 SDS（simple dynamic string），它是一个动态字符串结构，由长度、空闲空间和字节数组三部分组成

SDS有3种编码类型:
embstr 结构存储小于等于44个字节的字符串，embstr 每次开辟64个byte的空间
raw：存储大于44Bytes的数据
int：存储整数类型

![image](数据结构.assets/2253514-20230506155519782-1598201132.png)



### 使用场景:

- 缓存数据，提高访问速度和降低数据库压力。
- 计数器，利用 incr 和 decr 命令实现原子性的加减操作。



### hash冲突

头插





## hash

Hash类型的底层实现有三种：

- `ziplist`(7.0前)：压缩列表，当**hash**达到一定的阈值时，会自动转换为`hashtable`结构
- `listpack`：紧凑列表，Redis7.0之后，正式取代`ziplist`。同样, 达到一定的阈值时，会自动转换为`hashtable`结构
- `hashtable`：哈希表，类似map



### 扩容

len 和 size 相同就扩容

2倍, 渐进式, 每当操作到某个桶, 就去rehash这个桶到新的hash表
又或者在空闲时操作

### 使用场景:

主要是存储对象，比如：

- 用户信息，利用 hset 和 hget 命令实现对象属性的增删改查。
- 购物车，利用 hincrby 命令实现商品数量的增减。
- 配置信息，利用 hmset 和 hmget 命令实现批量设置和获取配置项。

## ziplist 的缺陷

![Screenshot 2024-11-26 at 20.05.05](Screenshot 2024-11-26 at 20.05.05.png)



![image-20241126181154476](image-20241126181154476.png)

https://www.kancloud.cn/zatko/redis/2274315

## listpack 解决 ziplist 问题

简化数据结构, 每个entry保存 本entry的encoding/data/len

[listpack 结构设计](https://xiaolincoding.com/redis/data_struct/data_struct.html#listpack-结构设计)



## bitmap

底层是string



## 参考

[Reids 连环炮面试（转） ](https://www.cnblogs.com/myseries/p/12071608.html)

[聊一聊redis十种数据类型及底层原理 ](https://www.cnblogs.com/reim/p/17377883.html)





