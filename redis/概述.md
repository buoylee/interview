## Redis的单线程和高性能

### Redis是单线程吗？

Redis 的单线程主要是指 Redis 的网络**IO和键值对读写是由一个线程来完成**的，这也是 Redis 对外提供键值存储服务的主要流程。
其他功能，比如**持久化、异步删除、集群数据同步**等，是由**额外的线程执行**的。

### Redis 单线程为什么还能这么快？

因为它所有的数据都在内存中，所有的运算都是**内存级别的运算**，
而且单线程**避免了多线程的切换性能损耗**问题。

正因为 Redis 是单线程，所以要**小心使用**那些耗时的指令（比如keys），一不小心就可能会导致Redis 卡顿。

### Redis 单线程如何处理那么多的并发客户端连接？

Redis的IO多路复用：redis利用**epoll来实现IO多路复用**，将连接信息和事件放到队列中，依次放到文件事件分派器，事件分派器将事件
分发给事件处理器。

<img src="Screenshot 2024-11-26 at 08.52.21.png" alt="Screenshot 2024-11-26 at 08.52.21" style="zoom: 33%;" />



## scan：渐进式遍历键

```
SCAN cursor ［MATCH pattern］［COUNT count］
```

提供了三个参数，
第一个是 cursor 整数值（**底層數據結構的hash桶的索引值**），
第二个是 **key 的正则模式**，
第三个是一次遍历的key的数量（**参考值，底层遍历的数量不一定**），**并不是符合条件的结果数量**。

第一次遍历时，**cursor 值为0**，然后将**返回结果中第一个整数**值作为下一次遍历的 cursor。一直**遍历到返回的 cursor 值为0时结束**。

因爲是**分段查詢**, 所以會有其他**寫操作改寫之前已查出的结果**, 又或者是 **rehash导致的key的位移**, 最终会有**不一致的现象**.